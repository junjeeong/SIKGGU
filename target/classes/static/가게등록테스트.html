<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sikggu API í…ŒìŠ¤íŠ¸ - ì‚¬ì¥ë‹˜/ê°€ê²Œ ë“±ë¡</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      border-bottom: 2px solid #ccc;
      padding-bottom: 10px;
      margin-top: 20px;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input[type="text"], input[type="password"] {
      width: 95%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    select {
      width: 98%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
    }

    button:hover {
      background-color: #0056b3;
    }

    pre {
      background-color: #eee;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>API í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´í„°</h1>
  <p>Console íƒ­ì„ ì—´ì–´ API í˜¸ì¶œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”. (F12)</p>
  <hr>

  <h2>1. ì‚¬ì¥ë‹˜ íšŒì›ê°€ì… (Sign Up)</h2>
  <form id="signUpForm">
    <label for="signUpEmail">ì´ë©”ì¼:</label>
    <input type="text" id="signUpEmail" value="store_test_new@example.com" required>
    <label for="signUpPassword">ë¹„ë°€ë²ˆí˜¸:</label>
    <input type="password" id="signUpPassword" value="Password123!" required>
    <label for="signUpNickname">ë‹‰ë„¤ì„:</label>
    <input type="text" id="signUpNickname" value="í…ŒìŠ¤íŠ¸ì‚¬ì¥ë‹˜" required>
    <label for="signUpPhone">ì „í™”ë²ˆí˜¸:</label>
    <input type="text" id="signUpPhone" value="010-9876-5432" required>
    <label for="signUpRole">ì—­í•  (Role):</label>
    <select id="signUpRole" required>
      <option value="STORE">STORE (ì‚¬ì¥ë‹˜)</option>
      <option value="USER">USER (ì¼ë°˜ ì‚¬ìš©ì)</option>
    </select>
    <button type="submit">íšŒì›ê°€ì… ìš”ì²­</button>
  </form>
  <p>ê²°ê³¼: <span id="signUpResult" class="error">ëŒ€ê¸° ì¤‘...</span></p>

  <h2>2. ë¡œê·¸ì¸ ë° í† í° íšë“ (Sign In)</h2>
  <form id="signInForm">
    <label for="signInEmail">ì´ë©”ì¼:</label>
    <input type="text" id="signInEmail" value="store_test_new@example.com" required>
    <label for="signInPassword">ë¹„ë°€ë²ˆí˜¸:</label>
    <input type="password" id="signInPassword" value="Password123!" required>
    <label for="signInRole">ì—­í•  (Role):</label>
    <select id="signInRole" required>
      <option value="STORE">STORE (ì‚¬ì¥ë‹˜)</option>
      <option value="USER">USER (ì¼ë°˜ ì‚¬ìš©ì)</option>
    </select>
    <button type="submit">ë¡œê·¸ì¸ ìš”ì²­</button>
  </form>
  <p>í† í°: <span id="tokenDisplay" class="error">í† í° ì—†ìŒ</span></p>

  <h2>3. ê°€ê²Œ ë“±ë¡ (Store Creation)</h2>
  <form id="createStoreForm">
    <label>ê°€ê²Œ ì´ë¦„:</label><input type="text" id="storeName" value="í…ŒìŠ¤íŠ¸ë°˜ì°¬ê°€ê²Œ" required>
    <label>ì „í™”ë²ˆí˜¸:</label><input type="text" id="storePhone" value="02-1234-5678" required>
    <label>ì£¼ì†Œ:</label><input type="text" id="storeAddress" value="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬" required>
    <label>ìœ„ë„ (Lat):</label><input type="text" id="storeLat" value="37.51" value="37.51" required>
    <label>ê²½ë„ (Lng):</label><input type="text" id="storeLng" value="127.01" value="127.01" required>
    <button type="submit">ê°€ê²Œ ë“±ë¡ ìš”ì²­ (í† í° í•„ìš”)</button>
  </form>
  <p>ê²°ê³¼: <span id="storeResult" class="error">ëŒ€ê¸° ì¤‘...</span></p>
  <pre id="storeResponsePre"></pre>
</div>

<script>
  const BASE_URL = "http://localhost:8080/api/v1"; // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ í¬íŠ¸ ì§€ì •
  let globalToken = null;

  // --- í—¬í¼ í•¨ìˆ˜ ---
  async function apiRequest(endpoint, method, body, requiresAuth = false) {
    const headers = {
      'Content-Type': 'application/json'
    };

    if (requiresAuth && globalToken) {
      headers['Authorization'] = `Bearer ${globalToken}`;
    } else if (requiresAuth && !globalToken) {
      console.error(`[${endpoint}] ì¸ì¦ ì‹¤íŒ¨: í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.`);
      throw new Error('ì¸ì¦ í† í° ì—†ìŒ');
    }

    try {
      const response = await fetch(`${BASE_URL}${endpoint}`, {
        method: method,
        headers: headers,
        body: body ? JSON.stringify(body) : null
      });

      if (!response.ok) {
        const contentType = response.headers.get("content-type");
        let errorData = {message: `HTTP Status: ${response.status} ${response.statusText}`};

        if (contentType && contentType.includes("application/json")) {
          errorData = await response.json().catch(() => ({message: 'ì—ëŸ¬ ì‘ë‹µ ë³¸ë¬¸ JSON íŒŒì‹± ì‹¤íŒ¨'}));
        } else {
          // 403 Forbidden ì‹œ HTML ì‘ë‹µì´ ì˜¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í…ìŠ¤íŠ¸ë¡œ ì²˜ë¦¬
          errorData.details = await response.text().catch(() => 'ì‘ë‹µ ë³¸ë¬¸ ì—†ìŒ');
        }

        console.error(`[${endpoint}] API ìš”ì²­ ì‹¤íŒ¨:`, response.status, errorData);
        throw new Error(`API ìš”ì²­ ì‹¤íŒ¨ (Status: ${response.status})`);
      }

      if (response.status === 204) {
        return {message: "No Content (Success)"};
      }

      return await response.json();

    } catch (error) {
      console.error(`[${endpoint}] ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì²˜ë¦¬ ì˜¤ë¥˜:`, error);
      throw error;
    }
  }

  // --- 1. íšŒì›ê°€ì… ---
  document.getElementById('signUpForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const signUpData = {
      email: document.getElementById('signUpEmail').value,
      password: document.getElementById('signUpPassword').value,
      // ğŸ’¡ ëˆ„ë½ëœ í•„ìˆ˜ í•„ë“œ ì¶”ê°€
      nickname: document.getElementById('signUpNickname').value,
      phoneNumber: document.getElementById('signUpPhone').value,
      role: document.getElementById('signUpRole').value
    };

    const resultSpan = document.getElementById('signUpResult');
    resultSpan.textContent = 'ìš”ì²­ ì¤‘...';
    resultSpan.className = 'error';

    try {
      const data = await apiRequest('/auth/sign-up', 'POST', signUpData);
      resultSpan.textContent = `íšŒì›ê°€ì… ì„±ê³µ. User ID: ${data.userId}`;
      resultSpan.className = 'success';
      console.log("íšŒì›ê°€ì… ì„±ê³µ:", data);
    } catch (e) {
      resultSpan.textContent = 'íšŒì›ê°€ì… ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)';
      resultSpan.className = 'error';
    }
  });

  // --- 2. ë¡œê·¸ì¸ ---
  document.getElementById('signInForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const signInData = {
      email: document.getElementById('signInEmail').value,
      password: document.getElementById('signInPassword').value,
      role: document.getElementById('signInRole').value
    };

    const tokenDisplay = document.getElementById('tokenDisplay');
    tokenDisplay.textContent = 'ìš”ì²­ ì¤‘...';
    tokenDisplay.className = 'error';

    try {
      const data = await apiRequest('/auth/sign-in', 'POST', signInData);
      globalToken = data.accessToken;
      tokenDisplay.textContent = `ë¡œê·¸ì¸ ì„±ê³µ! Token (ì• 10ê¸€ì): ${globalToken.substring(0, 10)}...`;
      tokenDisplay.className = 'success';
      console.log("ë¡œê·¸ì¸ ì„±ê³µ. í† í°:", data.accessToken);
    } catch (e) {
      tokenDisplay.textContent = 'ë¡œê·¸ì¸ ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)';
      globalToken = null;
      tokenDisplay.className = 'error';
    }
  });

  // --- 3. ê°€ê²Œ ë“±ë¡ ---
  document.getElementById('createStoreForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const storeData = {
      name: document.getElementById('storeName').value,
      phoneNumber: document.getElementById('storePhone').value,
      address: document.getElementById('storeAddress').value,
      latitude: parseFloat(document.getElementById('storeLat').value),
      longitude: parseFloat(document.getElementById('storeLng').value)
    };

    const resultSpan = document.getElementById('storeResult');
    const responsePre = document.getElementById('storeResponsePre');

    resultSpan.textContent = 'ìš”ì²­ ì¤‘...';
    resultSpan.className = 'error';
    responsePre.textContent = '';

    try {
      const data = await apiRequest('/stores', 'POST', storeData, true); // true: ì¸ì¦ í•„ìš”

      resultSpan.textContent = `ê°€ê²Œ ë“±ë¡ ì„±ê³µ! (HTTP 201 Created)`;
      resultSpan.className = 'success';
      responsePre.textContent = JSON.stringify(data, null, 2);
      console.log("ê°€ê²Œ ë“±ë¡ ì„±ê³µ:", data);

    } catch (e) {
      resultSpan.textContent = 'ê°€ê²Œ ë“±ë¡ ì‹¤íŒ¨ (ì½˜ì†” í™•ì¸)';
      resultSpan.className = 'error';
    }
  });
</script>

</body>
</html>